import{c as $,t as O,h as W,i as A,r as m,k as q,j as s,l as j,m as K,n as B,o as G,p as J,q as Q}from"./index-AXO9J3iA.js";const z=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],U=$("settings-2",z);function V(P,a,n){const r=O(P,n?.in);return isNaN(a)?W(P,NaN):(a&&r.setDate(r.getDate()+a),r)}const D={facility:{open_field:1,single_greenhouse:1.3,multi_greenhouse:1.5,glass_greenhouse:2,smart_farm:3.5},specs:{height_medium:1.1,height_high:1.3,heating:1.2,hydroponics:1.5,tunnel:1.25},date_reduction:{heating:20,tunnel:15,greenhouse_factor:.9,smart_farm_factor:.8}},H="soillab_simulation_config",I="soillab_simulation_permission";class E{static getConfig(){const a=localStorage.getItem(H);if(a)try{return{...D,...JSON.parse(a)}}catch(n){console.error("Failed to parse simulation config",n)}return D}static saveConfig(a){localStorage.setItem(H,JSON.stringify(a))}static resetToDefault(){localStorage.removeItem(H)}static isEditAllowed(){return localStorage.getItem(I)==="true"}static setEditAllowed(a){localStorage.setItem(I,String(a))}}const R={"ì„œìš¸/ê²½ê¸°":[-2.4,.4,5.7,12.5,17.8,22.2,24.9,25.7,21.2,14.8,7.2,.4],"ê°•ì› (ì˜ì„œ)":[-5,-2,4,11,16.5,21,24,24.5,19.5,12.5,5,-2],"ê°•ì› (ì˜ë™)":[.5,2.5,7,13,17.5,21,24.5,25,20.5,15.5,9,3],ì¶©ì²­ë¶ë„:[-2,.5,6,13,18.5,22.5,25,25.5,20.5,14,6.5,-.5],ì¶©ì²­ë‚¨ë„:[-1,1,6,12.5,18,22,25,25.5,21,14.5,7.5,1],ì „ë¼ë¶ë„:[0,2,7,13,18.5,22.5,25.5,26,21.5,15.5,8.5,2],ì „ë¼ë‚¨ë„:[2,4,8.5,14,19,22.5,26,26.5,22.5,17,10.5,4.5],ê²½ìƒë¶ë„:[0,2.5,7.5,13.5,18.5,22,25.5,26,21,15,8.5,2],ê²½ìƒë‚¨ë„:[3,5,9.5,14.5,19.5,23,26,26.5,22.5,17.5,11,5.5],ì œì£¼ë„:[6,7,10,15,19,22.5,26.5,27.5,24,19,13.5,8.5]};class X{static getMonthlyTemps(a){const n=Object.keys(R).find(r=>a.includes(r.substring(0,2)));return R[n||"ì„œìš¸/ê²½ê¸°"]}static getAverageTempDuringPeriod(a,n,r){const l=this.getMonthlyTemps(a);let t=n.getMonth(),o=r,c=0,e=0;for(;o>0;){const d=Math.min(o,30);c+=l[t%12]*d,o-=d,t++,e+=d}return c/e}static calculateHeatingDegreeDays(a,n,r,l){const t=this.getMonthlyTemps(a);let o=n.getMonth(),c=r,e=0;for(;c>0;){const d=t[o%12],g=l-d;if(g>0){const _=Math.min(c,30);e+=g*_}c-=30,o++}return e}}const Y={"í•œì§€í˜• ë§ˆëŠ˜":{name:"í•œì§€í˜• ë§ˆëŠ˜",daysToMaturity:240,baseYieldPerPyeong:4.5,standardCostPerPyeong:15e3,laborHoursPerPyeong:.6,optimalTemp:{min:15,max:20},criticalLowTemp:-7,optimalPH:{min:6,max:7},relatedMachines:["tractor","rotary","mulcher"]},"ë°°ì¶” (ê°€ì„)":{name:"ë°°ì¶” (ê°€ì„)",daysToMaturity:80,baseYieldPerPyeong:35,standardCostPerPyeong:8e3,laborHoursPerPyeong:.3,optimalTemp:{min:18,max:21},criticalLowTemp:4,optimalPH:{min:6,max:6.8},relatedMachines:["tractor","transplanter"]},"ë…¸ì§€ ê³ ì¶”":{name:"ë…¸ì§€ ê³ ì¶”",daysToMaturity:150,baseYieldPerPyeong:8,standardCostPerPyeong:12e3,laborHoursPerPyeong:.8,optimalTemp:{min:25,max:28},criticalLowTemp:10,optimalPH:{min:6,max:6.5},relatedMachines:["tractor","transplanter","dryer"]},"ë´„ ê°ì":{name:"ë´„ ê°ì",daysToMaturity:100,baseYieldPerPyeong:25,standardCostPerPyeong:1e4,laborHoursPerPyeong:.4,optimalTemp:{min:18,max:23},criticalLowTemp:5,optimalPH:{min:5,max:6},relatedMachines:["tractor","potato_planter","potato_harvester"]},"ì½© (ì„œë¦¬íƒœ)":{name:"ì½© (ì„œë¦¬íƒœ)",daysToMaturity:130,baseYieldPerPyeong:.8,standardCostPerPyeong:5e3,laborHoursPerPyeong:.2,optimalTemp:{min:20,max:25},criticalLowTemp:10,optimalPH:{min:6,max:7},relatedMachines:["tractor","seeder","combine_harvester","thresher"]},ê³ êµ¬ë§ˆ:{name:"ê³ êµ¬ë§ˆ",daysToMaturity:120,baseYieldPerPyeong:15,standardCostPerPyeong:9e3,laborHoursPerPyeong:.4,optimalTemp:{min:22,max:28},criticalLowTemp:15,relatedMachines:["tractor","sweet_potato_harvester"]},ì–‘íŒŒ:{name:"ì–‘íŒŒ",daysToMaturity:230,baseYieldPerPyeong:22,standardCostPerPyeong:14e3,laborHoursPerPyeong:.5,optimalTemp:{min:15,max:20},criticalLowTemp:-5,relatedMachines:["tractor","onion_transplanter","onion_harvester"]},ëŒ€íŒŒ:{name:"ëŒ€íŒŒ",daysToMaturity:180,baseYieldPerPyeong:12,standardCostPerPyeong:11e3,laborHoursPerPyeong:.5,optimalTemp:{min:15,max:20},criticalLowTemp:0,relatedMachines:["tractor","transplanter"]},í† ë§ˆí† :{name:"í† ë§ˆí† ",daysToMaturity:100,baseYieldPerPyeong:20,standardCostPerPyeong:18e3,laborHoursPerPyeong:1.5,optimalTemp:{min:21,max:25},criticalLowTemp:10,optimalPH:{min:6,max:6.5}},ë”¸ê¸°:{name:"ë”¸ê¸°",daysToMaturity:150,baseYieldPerPyeong:12,standardCostPerPyeong:2e4,laborHoursPerPyeong:2,optimalTemp:{min:17,max:23},criticalLowTemp:5,optimalPH:{min:5.5,max:6.5}},ê°ê·¤:{name:"ê°ê·¤",daysToMaturity:180,baseYieldPerPyeong:15,standardCostPerPyeong:15e3,laborHoursPerPyeong:1,optimalTemp:{min:20,max:25},criticalLowTemp:3}};class F{static getCropInfo(a){return Y[a]||Object.values(Y).find(n=>a.includes(n.name))}static getCropMachines(a){return this.getCropInfo(a)?.relatedMachines||["tractor"]}static calculateHarvestDate(a,n,r,l,t){const o=this.getCropInfo(n);if(!o)return"";const c=E.getConfig();let e=o.daysToMaturity;return r==="greenhouse"||r==="single_greenhouse"?e=e*c.date_reduction.greenhouse_factor:(r==="smart_farm"||r==="glass_greenhouse")&&(e=e*c.date_reduction.smart_farm_factor),t&&(t.heating&&(e=e-c.date_reduction.heating),r==="open_field"&&t.tunnel&&(e=e-c.date_reduction.tunnel)),l.includes("ê²½ë¶")||l.includes("ì „ë‚¨")||l.includes("ê²½ë‚¨")||l.includes("ì œì£¼")?e-=5:(l.includes("ê°•ì›")||l.includes("ê²½ê¸° ë¶ë¶€"))&&(e+=10),A(V(new Date(a),Math.floor(e)),"yyyy-MM-dd")}static getQualityRatio(a){switch(a){case"glass_greenhouse":return{tuk:.6,sang:.3,jung:.1,ha:0};case"multi_greenhouse":return{tuk:.45,sang:.35,jung:.15,ha:.05};case"single_greenhouse":case"greenhouse":return{tuk:.35,sang:.35,jung:.2,ha:.1};default:return{tuk:.2,sang:.3,jung:.3,ha:.2}}}static calculateExpectedYield(a,n,r,l){const t=this.getCropInfo(a);if(!t)return 0;const o=E.getConfig();let c=t.baseYieldPerPyeong*n,e=1;switch(r){case"open_field":e=o.facility.open_field;break;case"single_greenhouse":e=o.facility.single_greenhouse;break;case"multi_greenhouse":e=o.facility.multi_greenhouse;break;case"glass_greenhouse":e=o.facility.glass_greenhouse;break;case"smart_farm":e=o.facility.smart_farm;break;default:e=1}return l&&((r.includes("greenhouse")||r==="smart_farm")&&(l.height==="high"?e*=o.specs.height_high:l.height==="medium"&&(e*=o.specs.height_medium)),l.cultivation==="hydroponics"&&(e*=o.specs.hydroponics),l.heating&&(e*=o.specs.heating),r==="open_field"&&l.tunnel&&(e*=o.specs.tunnel)),Math.round(c*e)}static calculateTotalCost(a,n,r,l,t={},o){const c=this.getCropInfo(a);if(!c)return{total:0,energy:0,base:0,breakdown:[]};const e=[];let d=c.standardCostPerPyeong;t.cultivation==="hydroponics"?(d*=1.3,e.push("ì–‘ì•¡ ì¬ë°° ìì¬ë¹„ ì¦ê°€ (+30%)"),t.waterSource==="tap"?(d+=2e3,e.push("ìˆ˜ë—ë¬¼ ì‚¬ìš© ìˆ˜ë„ìš”ê¸ˆ ì¶”ê°€")):t.waterSource==="river"?t.hasFilter&&(d+=500,e.push("ê°•ë¬¼ ì—¬ê³¼ê¸° ìœ ì§€ë³´ìˆ˜ë¹„")):t.waterSource==="ground"&&(d+=300),t.ph&&(t.ph>7.5||t.ph<5.5)&&(d+=500,e.push(`ì›ìˆ˜ pH(${t.ph}) êµì •ì œ ë¹„ìš© ë°œìƒ`))):(t.ph!==void 0&&c.optimalPH&&(t.ph<c.optimalPH.min?(d+=500,e.push(`ì‚°ì„± í† ì–‘(pH ${t.ph}) ê°œëŸ‰: ì„íšŒ ì‹œë¹„ ë¹„ìš© ì¶”ê°€`)):t.ph>c.optimalPH.max&&(d+=800,e.push(`ì•Œì¹¼ë¦¬ì„± í† ì–‘(pH ${t.ph}) ê°œëŸ‰: ìœ í™©/í”¼íŠ¸ëª¨ìŠ¤ ë¹„ìš© ì¶”ê°€`))),t.om!==void 0&&t.om<20&&(d+=1e3,e.push(`ìœ ê¸°ë¬¼ ë¶€ì¡±(${t.om}g/kg): í‡´ë¹„ ì¶”ê°€ ì‹œë¹„`))),(r==="smart_farm"||r==="glass_greenhouse")&&(d*=1.2,e.push("ìŠ¤ë§ˆíŠ¸íŒœ ìœ ì§€ë³´ìˆ˜ë¹„ ì¦ê°€ (+20%)"));let g=d*n,_=c.laborHoursPerPyeong*n;t.cultivation!=="hydroponics"?(t.machines||[]).forEach(p=>{let h=typeof p=="string"?p:p.name,S=typeof p=="string"?"own":p.type,u=0,y=0;if(h.includes("tractor")?u=.4:h.includes("planter")||h.includes("transplanter")||h.includes("harvester")?u=.25:h.includes("dryer")&&(u=.05),_*=1-u,S==="rent"){const f=Math.max(1,Math.ceil(n/500)),b=5e4*f;y=b,e.push(`${h} ì„ëŒ€ (${f}ì¼): ë…¸ë™ë ¥ ì ˆê° & ì„ëŒ€ë£Œ ${b.toLocaleString()}ì›`)}else y=(h.includes("tractor")?1e3:500)*n,e.push(`${h} ë³´ìœ : ë…¸ë™ë ¥ ì ˆê° & ê°ê°€ìƒê°/ìœ ì§€ë¹„ ${y.toLocaleString()}ì›`);g+=y}):(_*=.5,e.push("ì–‘ì•¡/ìŠ¤ë§ˆíŠ¸íŒœ ìë™í™”: ë…¸ë™ë ¥ 50% ì ˆê°"));const N=c.laborHoursPerPyeong*n*2e4,v=_*2e4,C=N-v;C>0&&(g-=C,e.push(`ê¸°ê³„í™”/ìë™í™” ì¸ê±´ë¹„ ì ˆê°: -${Math.round(C).toLocaleString()}ì›`));let M=0;if(t.heating&&o!==void 0){const w=t.location||"ì„œìš¸/ê²½ê¸°",p=new Date(l),h=c.daysToMaturity,S=X.calculateHeatingDegreeDays(w,p,h,o);if(S>0){let u=6;switch(r){case"open_field":u=10;break;case"single_greenhouse":u=6;break;case"multi_greenhouse":u=4.5;break;case"glass_greenhouse":u=3.5;break;case"smart_farm":u=2;break}t.tunnel&&(u*=.8);const y=n*3.3*1.5,b=u*y*24*S/1e3;M=b*80,e.push(`ì˜ˆìƒ ë‚œë°© ì—ë„ˆì§€: ${Math.round(b).toLocaleString()} kWh`),e.push(`ë‚œë°©ë¹„ (@80ì›): ${Math.round(M).toLocaleString()}ì›`)}}return{base:Math.round(g),energy:Math.round(M),total:Math.round(g+M),breakdown:e}}static calculateExpectedCost(a,n){const r=this.getCropInfo(a);return r?r.standardCostPerPyeong*n:0}}function te(){const[P,a]=m.useState(!1),[n,r]=m.useState(null),[l,t]=m.useState([]),[o,c]=m.useState(null),[e,d]=m.useState("ê³ êµ¬ë§ˆ"),[g,_]=m.useState(A(new Date,"yyyy-MM-dd")),[N,v]=m.useState("open_field"),[C,M]=m.useState(!1),[w,p]=m.useState(20),[h,S]=m.useState({tuk:.2,sang:.3,jung:.3,ha:.2}),[u,y]=m.useState({height:"low",heating:!1,cultivation:"soil",tunnel:!1,machines:[],soilCondition:"average",waterSource:"tap",hasFilter:!1}),[f,b]=m.useState(null);m.useEffect(()=>{try{const i=q.getFields();t(i),i&&i.length>0&&(c(String(i[0].id)),i[0].facilityType&&v(i[0].facilityType))}catch(i){console.error("RevenueCalculator: Critical Error loading fields",i),r(i.toString()),a(!0)}},[]),m.useEffect(()=>{if(o){const i=l.find(x=>String(x.id)===o);i&&(v(i.facilityType),S(F.getQualityRatio(i.facilityType)),i.specs&&y(x=>({...x,height:i.specs.height||"medium",heating:i.equipment?.heating||!1,waterSource:i.waterSource||"ground"})))}},[o,l]);const L=()=>{if(!o)return;const i=l.find(x=>String(x.id)===o);if(i)try{const T=F.calculateTotalCost(e,i.area,N,g,{...u,location:i.location},w),k=T.total;b({harvestDate:"2024-10-15",yieldAmount:1e3,breakdown:[],totalRevenue:2e6,cost:k,profit:2e6-k,totalCost:k,costDetails:{base:T.base,energy:T.energy,breakdown:T.breakdown}})}catch(x){console.error(x),alert("ê³„ì‚° ì¤‘ ì˜¤ë¥˜ ë°œìƒ")}};return P?s.jsxs("div",{className:"mx-auto max-w-4xl space-y-4 p-6",children:[s.jsxs("div",{className:"rounded-lg border border-yellow-200 bg-yellow-50 p-4",children:[s.jsx("h2",{className:"flex items-center gap-2 text-xl font-bold text-yellow-800",children:"ğŸ›¡ï¸ ì•ˆì „ ëª¨ë“œ (ì§„ë‹¨ ì¤‘)"}),s.jsxs("p",{className:"mt-2 text-yellow-700",children:["ì‹œë®¬ë ˆì´í„° ë¡œë”© ì¤‘ ë¬¸ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì•ˆì „ ëª¨ë“œë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.",s.jsx("br",{}),"ë°ì´í„° ë¡œë“œ ìƒíƒœ: ",n?`ì˜¤ë¥˜ (${n})`:"ì •ìƒ"]}),s.jsx("div",{className:"mt-4 rounded border bg-white p-4",children:s.jsxs("p",{className:"font-mono text-sm",children:["ë¶ˆëŸ¬ì˜¨ ë†ì§€ ìˆ˜: ",l.length,"ê°œ"]})})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(j,{onClick:()=>window.location.reload(),variant:"outline",children:"ìƒˆë¡œê³ ì¹¨"}),s.jsx(j,{onClick:()=>a(!1),className:"bg-blue-600 text-white hover:bg-blue-700",children:"ì¼ë°˜ ëª¨ë“œë¡œ ì „í™˜ í…ŒìŠ¤íŠ¸ (ì£¼ì˜)"})]})]}):s.jsx("div",{className:"mx-auto max-w-6xl space-y-6",children:s.jsxs(K,{children:[s.jsx(B,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(G,{className:"flex items-center gap-2 text-lg",children:[s.jsx(J,{className:"h-5 w-5 text-blue-600"}),"ë†ì§€ë³„ ì‘ê¸° ê³„íší•˜ê¸°"]}),s.jsxs(j,{variant:"ghost",size:"sm",className:"text-slate-400 hover:text-slate-600",onClick:()=>M(!C),children:[s.jsx(U,{className:"mr-1 h-4 w-4"}),"ê³„ìˆ˜ ì„¤ì •"]})]})}),s.jsxs(Q,{children:[C&&s.jsx("div",{className:"mb-4 rounded bg-slate-50 p-4 text-center text-slate-500",children:"ê³„ìˆ˜ ì„¤ì • íŒ¨ë„ (ì ê²€ ì¤‘)"}),s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"mb-1 block text-sm font-medium",children:"ë†ì§€ ì„ íƒ"}),s.jsx("select",{className:"w-full rounded border p-2",value:o||"",onChange:i=>c(i.target.value),children:l.map(i=>s.jsx("option",{value:i.id,children:i.name},i.id))})]}),s.jsx(j,{onClick:L,className:"w-full",children:"ë†ì§€ ì‘ê¸° ê³„íš"})]}),s.jsxs("div",{className:"rounded-lg bg-slate-50 p-4",children:[s.jsx("h3",{className:"mb-2 font-bold",children:"ë¶„ì„ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°"}),f?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:["ì˜ˆìƒ ë§¤ì¶œ: ",f.totalRevenue.toLocaleString(),"ì›"]}),s.jsxs("p",{children:["ì˜ˆìƒ ë¹„ìš©: ",f.totalCost.toLocaleString(),"ì›"]}),s.jsxs("p",{className:"text-xl font-bold text-blue-600",children:["ìˆœìˆ˜ìµ: ",f.profit.toLocaleString(),"ì›"]})]}):s.jsx("p",{className:"text-sm text-slate-400",children:"ì™¼ìª½ì—ì„œ ë†ì§€ë¥¼ ì„ íƒí•˜ê³  ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”."})]})]})]})]})})}export{te as RevenueCalculator};
